<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Computes the Matrix Profile and Profile Index — tsmp • tsmp</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Computes the Matrix Profile and Profile Index — tsmp"><meta property="og:description" content="This is a wrap function that makes easy to use all available algorithms to compute the Matrix
Profile and Profile Index for multiple purposes."><meta property="og:image" content="https://matrixprofile.org/tsmp/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tsmp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.15</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/press.html">Time Series with Matrix Profile</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/matrix-profile-foundation/tsmp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Computes the Matrix Profile and Profile Index</h1>
    <small class="dont-index">Source: <a href="https://github.com/matrix-profile-foundation/tsmp/blob/HEAD/R/tsmp.R" class="external-link"><code>R/tsmp.R</code></a></small>
    <div class="hidden name"><code>tsmp.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is a wrap function that makes easy to use all available algorithms to compute the Matrix
Profile and Profile Index for multiple purposes.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">tsmp</span><span class="op">(</span>
  <span class="va">...</span>,
  <span class="va">window_size</span>,
  exclusion_zone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"tsmp.exclusion_zone"</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,
  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stomp"</span>, <span class="st">"stamp"</span>, <span class="st">"simple"</span>, <span class="st">"mstomp"</span>, <span class="st">"scrimp"</span>, <span class="st">"valmod"</span>, <span class="st">"pmp"</span><span class="op">)</span>,
  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"tsmp.verbose"</span>, <span class="fl">2</span><span class="op">)</span>,
  n_workers <span class="op">=</span> <span class="fl">1</span>,
  s_size <span class="op">=</span> <span class="cn">Inf</span>,
  must_dim <span class="op">=</span> <span class="cn">NULL</span>,
  exc_dim <span class="op">=</span> <span class="cn">NULL</span>,
  heap_size <span class="op">=</span> <span class="fl">50</span>,
  paa <span class="op">=</span> <span class="fl">1</span>,
  .keep_data <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>...</dt>
<dd><p>a <code>matrix</code> or a <code>vector</code>. If a second time series is supplied it will be a join matrix
profile (except for <code><a href="mstomp.html">mstomp()</a></code>).</p></dd>


<dt>window_size</dt>
<dd><p>an <code>int</code> with the size of the sliding window. Use a vector for Valmod.</p></dd>


<dt>exclusion_zone</dt>
<dd><p>a <code>numeric</code>. Size of the exclusion zone, based on window size (default is
<code>1/2</code>). See details.</p></dd>


<dt>mode</dt>
<dd><p>the algorithm that will be used to compute the matrix profile. (Default is <code>stomp</code>).
See details.</p></dd>


<dt>verbose</dt>
<dd><p>an <code>int</code>. (Default is <code>2</code>). See details.</p></dd>


<dt>n_workers</dt>
<dd><p>an <code>int</code>. Number of workers for parallel. (Default is <code>1</code>).</p></dd>


<dt>s_size</dt>
<dd><p>a <code>numeric</code>. for anytime algorithm, represents the size (in observations) the
random calculation will occur (default is <code>Inf</code>). See details.</p></dd>


<dt>must_dim</dt>
<dd><p>an <code>int</code> or <code>vector</code> of which dimensions to forcibly include (default is <code>NULL</code>).
See details.</p></dd>


<dt>exc_dim</dt>
<dd><p>an <code>int</code> or <code>vector</code> of which dimensions to exclude (default is <code>NULL</code>). See
details.</p></dd>


<dt>heap_size</dt>
<dd><p>an <code>int</code>. (Default is <code>50</code>). Size of the distance profile heap buffer.</p></dd>


<dt>paa</dt>
<dd><p>an <code>int</code>. (Default is <code>1</code>). Factor of PAA reduction (2 == half of size)</p></dd>


<dt>.keep_data</dt>
<dd><p>a <code>logical</code>. (Default is <code>TRUE</code>). Keeps the data embedded to resultant object.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns the matrix profile <code>mp</code> and profile index <code>pi</code>. It also returns the left and
right matrix profile <code>lmp</code>, <code>rmp</code> and profile index <code>lpi</code>, <code>rpi</code> that may be used to detect
Time Series Chains. <code><a href="mstomp.html">mstomp()</a></code> returns a multidimensional Matrix Profile.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The Matrix Profile, has the potential to revolutionize time series data mining because
of its generality, versatility, simplicity and scalability. In particular it has implications
for time series motif discovery, time series joins, shapelet discovery (classification),
density estimation, semantic segmentation, visualization, rule discovery, clustering etc.</p>
<p>The first algorithm invented was the <code><a href="stamp.html">stamp()</a></code> that using <code><a href="tsmp-deprecated.html">mass()</a></code> as an ultra-fast Algorithm
for Similarity Search allowed to compute the Matrix Profile in reasonable time. One of its main
feature was its Anytime property which using a randomized approach could return a "best-so-far"
matrix that could give us the correct answer (using for example 1/10 of all iterations) almost
every time.</p>
<p>The next algorithm was <code><a href="stomp.html">stomp()</a></code> that currently is the most used. Researchers noticed that the
dot products do not need to be recalculated from scratch for each subsequence. Instead, we can
reuse the values calculated for the first subsequence to make a faster calculation in the next
iterations. The idea is to make use of the intersections between the required products in
consecutive iterations. This approach reduced the time to compute the Matrix Profile to about
3% compared to <code><a href="stamp.html">stamp()</a></code>, but on the other hand, we lost the Anytime property.</p>
<p>Currently there is a new algorithm that I'll not explain further here. It is called <code><a href="scrimp.html">scrimp()</a></code>,
and is as fast as <code><a href="stomp.html">stomp()</a></code>, and have the Anytime property. This algorithm is implemented in
this package, but still waiting for an article publication.</p>
<p>Further, there is the <code><a href="mstomp.html">mstomp()</a></code> that computes a multidimensional Matrix Profile that allows to
meaningful MOTIF discovery in Multivariate Time Series. And <code><a href="simple_fast.html">simple_fast()</a></code> that also handles
Multivariate Time Series, but focused in Music Analysis and Exploration.</p>
<p>The <code><a href="valmod.html">valmod()</a></code> uses a new pruning algorithm allowing a similarity search with a range of sliding
window sizes.</p>
<p>The <code><a href="pmp.html">pmp()</a></code> is a new concept that creates several profiles from a range of windows.</p>
<p>Some parameters are global across the algorithms:</p><dl><dt>...</dt>
<dd><p>One or two time series (except for <code><a href="mstomp.html">mstomp()</a></code>). The second time series can be smaller than the first.</p></dd>

<dt>window_size</dt>
<dd><p>The sliding window.</p></dd>

<dt>exclusion_zone</dt>
<dd><p>Is used to avoid trivial matches; if a query data is provided
(join similarity), this parameter is ignored.</p></dd>

<dt>verbose</dt>
<dd><p>Changes how much information is printed by this function; <code>0</code> means nothing,
<code>1</code> means text, <code>2</code> adds the progress bar, <code>3</code> adds the finish sound.</p></dd>

<dt>n_workers</dt>
<dd><p>number of threads for parallel computing (except <code>simple_fast</code>, <code>scrimp</code> and <code>valmod</code>).
If the value is 2 or more, the '_par' version of the algorithm will be used.</p></dd>


</dl><p><code>s_size</code> is used only in Anytime algorithms: <code><a href="stamp.html">stamp()</a></code> and <code><a href="scrimp.html">scrimp()</a></code>.
<code>must_dim</code> and <code>exc_dim</code> are used only in <code><a href="mstomp.html">mstomp()</a></code>.
<code>heap_size</code> is used only for <code><a href="valmod.html">valmod()</a></code>
<code>mode</code> can be any of the following: <code>stomp</code>, <code>stamp</code>, <code>simple</code>, <code>mstomp</code>, <code>scrimp</code>, <code>valmod</code>, <code>pmp</code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    
<ul><li><p>Silva D, Yeh C, Batista G, Keogh E. Simple: Assessing Music Similarity Using
Subsequences Joins. Proc 17th ISMIR Conf. 2016;23-30.</p></li>
</ul><ul><li><p>Silva DF, Yeh C-CM, Zhu Y, Batista G, Keogh E. Fast Similarity Matrix Profile for
Music Analysis and Exploration. IEEE Trans Multimed. 2018;14(8):1-1.</p></li>
</ul><ul><li><p>Yeh CM, Kavantzas N, Keogh E. Matrix Profile VI : Meaningful Multidimensional Motif
Discovery.</p></li>
</ul><ul><li><p>Yeh CCM, Zhu Y, Ulanova L, Begum N, Ding Y, Dau HA, et al. Matrix profile I: All
pairs similarity joins for time series: A unifying view that includes motifs, discords and
shapelets. Proc - IEEE Int Conf Data Mining, ICDM. 2017;1317-22.</p></li>
</ul><ul><li><p>Zhu Y, Imamura M, Nikovski D, Keogh E. Matrix Profile VII: Time Series Chains: A
New Primitive for Time Series Data Mining. Knowl Inf Syst. 2018 Jun 2;1-27.</p></li>
</ul><ul><li><p>Zhu Y, Zimmerman Z, Senobari NS, Yeh CM, Funning G. Matrix Profile II : Exploiting
a Novel Algorithm and GPUs to Break the One Hundred Million Barrier for Time Series Motifs and
Joins. Icdm. 2016 Jan 22;54(1):739-48.</p></li>
</ul><p>Website: <a href="https://sites.google.com/view/simple-fast" class="external-link">https://sites.google.com/view/simple-fast</a></p>
<p>Website: <a href="https://sites.google.com/site/ismir2016simple/home" class="external-link">https://sites.google.com/site/ismir2016simple/home</a></p>
<p>Website: <a href="http://www.cs.ucr.edu/~eamonn/MatrixProfile.html" class="external-link">http://www.cs.ucr.edu/~eamonn/MatrixProfile.html</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other matrix profile computations: 
<code><a href="mstomp.html">mstomp_par</a>()</code>,
<code><a href="scrimp.html">scrimp</a>()</code>,
<code><a href="stamp.html">stamp_par</a>()</code>,
<code><a href="stomp.html">stomp_par</a>()</code>,
<code><a href="valmod.html">valmod</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># default with [stomp()]</span></span>
<span class="r-in"><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu">tsmp</span><span class="op">(</span><span class="va">mp_toy_data</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="fl">1</span><span class="op">]</span>, window_size <span class="op">=</span> <span class="fl">30</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Anytime STAMP</span></span>
<span class="r-in"><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu">tsmp</span><span class="op">(</span><span class="va">mp_toy_data</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="fl">1</span><span class="op">]</span>, window_size <span class="op">=</span> <span class="fl">30</span>, mode <span class="op">=</span> <span class="st">"stamp"</span>, s_size <span class="op">=</span> <span class="fl">50</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># [mstomp()]</span></span>
<span class="r-in"><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu">tsmp</span><span class="op">(</span><span class="va">mp_toy_data</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span>, window_size <span class="op">=</span> <span class="fl">30</span>, mode <span class="op">=</span> <span class="st">"mstomp"</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># [simple_fast()]</span></span>
<span class="r-in"><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu">tsmp</span><span class="op">(</span><span class="va">mp_toy_data</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span>, window_size <span class="op">=</span> <span class="fl">30</span>, mode <span class="op">=</span> <span class="st">"simple"</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="co"># parallel with [stomp_par()]</span></span>
<span class="r-in"><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu">tsmp</span><span class="op">(</span><span class="va">mp_test_data</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="fl">1</span><span class="op">]</span>, window_size <span class="op">=</span> <span class="fl">30</span>, n_workers <span class="op">=</span> <span class="fl">2</span>, verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in {    work_len &lt;- length(idx_work[[i]])    pro_muls &lt;- matrix(Inf, matrix_profile_size, 1)    pro_idxs &lt;- matrix(-Inf, matrix_profile_size, 1)    if (join) {        pro_muls_right &lt;- pro_muls_left &lt;- NULL        pro_idxs_right &lt;- pro_idxs_left &lt;- NULL    }    else {        pro_muls_right &lt;- pro_muls_left &lt;- pro_muls        pro_idxs_right &lt;- pro_idxs_left &lt;- pro_idxs    }    dist_pro &lt;- matrix(0, matrix_profile_size, 1)    last_product &lt;- matrix(0, matrix_profile_size, 1)    drop_value &lt;- matrix(0, 1, 1)    for (j in 1:work_len) {        idx_st &lt;- idx_work[[i]][1]        idx_ed &lt;- idx_work[[i]][work_len]        idx &lt;- idx_work[[i]][j]        query_window &lt;- as.matrix(query[idx:(idx + window_size -             1), 1])        if (j == 1) {            nni &lt;- dist_profile(data, query, nn, index = idx)            dist_pro[, 1] &lt;- nni$distance_profile            last_product[, 1] &lt;- nni$last_product        }        else {            last_product[2:(data_size - window_size + 1), 1] &lt;- last_product[1:(data_size -                 window_size), 1] - data[1:(data_size - window_size),                 1] * drop_value + data[(window_size + 1):data_size,                 1] * query_window[window_size, 1]            last_product[1, 1] &lt;- first_product[idx, 1]            dist_pro &lt;- 2 * (window_size - (last_product - window_size *                 nni$par$data_mean * nni$par$query_mean[idx])/(nni$par$data_sd *                 nni$par$query_sd[idx]))        }        dist_pro[dist_pro &lt; 0] &lt;- 0        dist_pro &lt;- sqrt(dist_pro)        drop_value &lt;- query_window[1, 1]        if (exclusion_zone &gt; 0) {            exc_st &lt;- max(1, idx - exclusion_zone)            exc_ed &lt;- min(matrix_profile_size, idx + exclusion_zone)            dist_pro[exc_st:exc_ed, 1] &lt;- Inf        }        dist_pro[nni$par$data_sd &lt; vars()$eps] &lt;- Inf        if (skip_location[idx] || any(nni$par$query_sd[idx] &lt;             vars()$eps)) {            dist_pro[] &lt;- Inf        }        dist_pro[skip_location] &lt;- Inf        if (!join) {            ind &lt;- (dist_pro[idx:matrix_profile_size] &lt; pro_muls_left[idx:matrix_profile_size])            ind &lt;- c(rep(FALSE, (idx - 1)), ind)            pro_muls_left[ind] &lt;- dist_pro[ind]            pro_idxs_left[which(ind)] &lt;- idx            ind &lt;- (dist_pro[1:idx] &lt; pro_muls_right[1:idx])            ind &lt;- c(ind, rep(FALSE, matrix_profile_size - idx))            pro_muls_right[ind] &lt;- dist_pro[ind]            pro_idxs_right[which(ind)] &lt;- idx        }        ind &lt;- (dist_pro &lt; pro_muls)        pro_muls[ind] &lt;- dist_pro[ind]        pro_idxs[which(ind)] &lt;- idx    }    res &lt;- list(pro_muls = pro_muls, pro_idxs = pro_idxs, pro_muls_left = pro_muls_left,         pro_idxs_left = pro_idxs_left, pro_muls_right = pro_muls_right,         pro_idxs_right = pro_idxs_right)    res}:</span> task 1 failed - "could not find function "mass_v3""</span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Francisco Bischoff.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

